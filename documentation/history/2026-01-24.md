# 2026-01-24

## Summary

Implemented alternative query syntax support (Issue #38).

## What was accomplished

- Added alternative `dataview-serializer-` prefix syntax for all query types
- Both legacy and alternative syntaxes work simultaneously without deprecation
- Each query generates matching result markers (legacy query → legacy markers, alternative → alternative markers)

## Implementation details

### New constants added (`src/app/constants.ts`)

Block queries:

- `QUERY_FLAG_OPEN_ALT` = `<!-- dataview-serializer-query: `
- `QUERY_FLAG_MANUAL_OPEN_ALT` = `<!-- dataview-serializer-query-manual: `
- `QUERY_FLAG_ONCE_OPEN_ALT` = `<!-- dataview-serializer-query-once: `
- `QUERY_FLAG_ONCE_AND_EJECT_OPEN_ALT` = `<!-- dataview-serializer-query-once-and-eject: `
- `SERIALIZED_QUERY_START_ALT` = `<!-- dataview-serializer-result: `
- `SERIALIZED_QUERY_END_ALT` = `<!-- dataview-serializer-result-end -->`

Inline queries:

- `INLINE_QUERY_FLAG_OPEN_ALT` = `<!-- dataview-serializer-iq: `
- `INLINE_QUERY_FLAG_MANUAL_OPEN_ALT` = `<!-- dataview-serializer-iq-manual: `
- `INLINE_QUERY_FLAG_ONCE_OPEN_ALT` = `<!-- dataview-serializer-iq-once: `
- `INLINE_QUERY_FLAG_ONCE_AND_EJECT_OPEN_ALT` = `<!-- dataview-serializer-iq-once-and-eject: `
- `INLINE_QUERY_END_ALT` = `<!-- /dataview-serializer-iq -->`

### Type changes

- Added `SyntaxVariant` type (`'legacy' | 'alternative'`) to `find-queries.fn.ts`
- Added `syntaxVariant` field to `QueryWithContext` interface
- Added `syntaxVariant` field to `InlineQueryWithContext` interface
- Added optional `syntaxVariant` parameter to `buildSerializedInlineQuery()` function

### Files modified

1. `src/app/constants.ts` - Added all alternative syntax constants
2. `src/app/utils/find-queries.fn.ts` - Updated to detect both syntaxes (alternative first due to longer prefixes)
3. `src/app/utils/find-inline-queries.fn.ts` - Updated to detect both syntaxes for inline queries
4. `src/app/plugin.ts` - Updated to use matching result markers and detect both syntaxes for idempotency checks
5. `src/app/refresh-button-extension.ts` - Updated to detect both syntaxes for decorations

### Tests added

- Alternative syntax detection for all 4 update modes (auto, manual, once, once-and-eject)
- Alternative syntax for multi-line queries
- Mixed legacy and alternative syntax in same file
- Deduplication across both syntaxes
- Alternative syntax for inline queries
- `buildSerializedInlineQuery` with alternative syntax

### Documentation updated

- Added "Query Syntax Reference" section to `AGENTS.md`
- Added "Alternative Syntax" section to `docs/usage.md`

## Key decisions

- Alternative syntax prefixes are checked first (longer prefixes prevent partial matches)
- Closing flag ` -->` is the same for both syntaxes (only opening markers differ)
- Conversion commands use legacy syntax for maximum compatibility
- No deprecation of legacy syntax - both work indefinitely
